--- nagios-4.3.1/sample-config/httpd.conf.in	2017-02-23 12:00:40.000000000 -0800
+++ nagios-4.3.1.patch/sample-config/httpd.conf.in	2017-02-28 13:10:36.000000000 -0800
@@ -5,12 +5,11 @@
 # configuration file.  Customize the paths, etc. as
 # needed to fit your system.
 
-ScriptAlias @cgiurl@ "@sbindir@"
+ScriptAlias @cgiurl@ "@cgidir@"
 
-<Directory "@sbindir@">
+<Directory "@cgidir@">
 #  SSLRequireSSL
    Options ExecCGI
-   AllowOverride None
    <IfVersion >= 2.3>
       <RequireAll>
          Require all granted
@@ -18,8 +17,24 @@
 
          AuthName "Nagios Access"
          AuthType Basic
-         AuthUserFile @sysconfdir@/htpasswd.users
-         Require valid-user
+         AuthUserFile @sysconfdir@/passwd
+         <IfModule mod_authz_core.c>
+            # Apache 2.4
+            <RequireAll>
+               Require all granted
+               # Require local
+               Require valid-user
+            </RequireAll>
+         </IfModule>
+         <IfModule !mod_authz_core.c>
+            # Apache 2.2
+            Order allow,deny
+            Allow from all
+            #  Order deny,allow
+            #  Deny from all
+            #  Allow from 127.0.0.1
+            Require valid-user
+         </IfModule>
       </RequireAll>
    </IfVersion>
    <IfVersion < 2.3>
@@ -31,7 +46,7 @@
 
       AuthName "Nagios Access"
       AuthType Basic
-      AuthUserFile @sysconfdir@/htpasswd.users
+      AuthUserFile @sysconfdir@/passwd
       Require valid-user
    </IfVersion>
 </Directory>
@@ -41,16 +56,31 @@
 <Directory "@datadir@">
 #  SSLRequireSSL
    Options None
-   AllowOverride None
    <IfVersion >= 2.3>
       <RequireAll>
          Require all granted
-#        Require host 127.0.0.1
 
          AuthName "Nagios Access"
          AuthType Basic
-         AuthUserFile @sysconfdir@/htpasswd.users
-         Require valid-user
+         AuthUserFile @sysconfdir@/passwd
+
+          <IfModule mod_authz_core.c>
+            # Apache 2.4
+            <RequireAll>
+               Require all granted
+               # Require local
+               Require valid-user
+            </RequireAll>
+         </IfModule>
+         <IfModule !mod_authz_core.c>
+            # Apache 2.2
+            Order allow,deny
+            Allow from all
+            #  Order deny,allow
+            #  Deny from all
+            #  Allow from 127.0.0.1
+            Require valid-user
+         </IfModule>
       </RequireAll>
    </IfVersion>
    <IfVersion < 2.3>
@@ -62,7 +92,7 @@
 
       AuthName "Nagios Access"
       AuthType Basic
-      AuthUserFile @sysconfdir@/htpasswd.users
+      AuthUserFile @sysconfdir@/passwd
       Require valid-user
    </IfVersion>
 </Directory>
--- nagios-4.3.1/sample-config/httpd.conf.in	2017-02-23 12:00:40.000000000 -0800
+++ nagios-4.3.1.patch/sample-config/httpd.conf.in	2017-02-27 15:11:56.000000000 -0800
@@ -5,9 +5,9 @@
 # configuration file.  Customize the paths, etc. as
 # needed to fit your system.
 
-ScriptAlias @cgiurl@ "@sbindir@"
+ScriptAlias @cgiurl@ "@cgidir@"
 
-<Directory "@sbindir@">
+<Directory "@cgidir@">
 #  SSLRequireSSL
    Options ExecCGI
    AllowOverride None
--- nagios-4.3.1/subst.in	2017-02-23 12:00:40.000000000 -0800
+++ nagios-4.3.1.patch/subst.in	2017-02-27 15:11:56.000000000 -0800
@@ -35,6 +35,7 @@
 		s|\@datarootdir\@|@datarootdir@|g;
 		s|\@sbindir\@|@sbindir@|g;
 		s|\@bindir\@|@bindir@|g;
+		s|\@cgidir\@|@libdir@/cgi-bin/|g;
 		s|\@htmurl\@|@htmurl@|g;
 		s|\@cgiurl\@|@cgiurl@|g;
 		s|\@MAIL_PROG\@|@MAIL_PROG@|g;
From b8c27bebfad2feccfe8b2c375f702502f0bc6048 Mon Sep 17 00:00:00 2001
From: Davide Madrisan <davide.madrisan@gmail.com>
Date: Thu, 18 Nov 2010 18:57:14 +0300
Subject: [PATCH 09/11] Fixed path to passwd file in Apache's config file

---
 sample-config/httpd.conf.in |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/sample-config/httpd.conf.in b/sample-config/httpd.conf.in
index 1b1e693..0a32781 100644
--- a/sample-config/httpd.conf.in
+++ b/sample-config/httpd.conf.in
@@ -18,7 +18,7 @@
 
          AuthName "Nagios Access"
          AuthType Basic
-         AuthUserFile @sysconfdir@/htpasswd.users
+         AuthUserFile @sysconfdir@/passwd
          Require valid-user
       </RequireAll>
    </IfVersion>
@@ -31,7 +31,7 @@
 
       AuthName "Nagios Access"
       AuthType Basic
-      AuthUserFile @sysconfdir@/htpasswd.users
+      AuthUserFile @sysconfdir@/passwd
       Require valid-user
    </IfVersion>
 </Directory>
@@ -49,7 +49,7 @@
 
          AuthName "Nagios Access"
          AuthType Basic
-         AuthUserFile @sysconfdir@/htpasswd.users
+         AuthUserFile @sysconfdir@/passwd
          Require valid-user
       </RequireAll>
    </IfVersion>
@@ -62,7 +62,7 @@
 
       AuthName "Nagios Access"
       AuthType Basic
-      AuthUserFile @sysconfdir@/htpasswd.users
+      AuthUserFile @sysconfdir@/passwd
       Require valid-user
    </IfVersion>
 </Directory>
